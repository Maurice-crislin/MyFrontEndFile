<html>
    <head>
        <title>交叉检测器判断是否进入可视区的图片懒加载</title>
    </head>
    <body>
        
        <img src="./loading.jpg" data-src="./1.jpg" ></img>       
        <img src="./loading.jpg" data-src="./2.jpg" ></img>
        <img src="./loading.jpg" data-src="./3.jpg" ></img>    
        <img src="./loading.jpg" data-src="./4.jpg" ></img> 
        <img src="./loading.jpg" data-src="./1.jpg" ></img>       
        <img src="./loading.jpg" data-src="./2.jpg" ></img>
        <img src="./loading.jpg" data-src="./3.jpg" ></img>    
        <img src="./loading.jpg" data-src="./4.jpg" ></img> 
        <img src="./loading.jpg" data-src="./1.jpg" ></img>       
        <img src="./loading.jpg" data-src="./2.jpg" ></img>
        <img src="./loading.jpg" data-src="./3.jpg" ></img>    
        <img src="./loading.jpg" data-src="./4.jpg" ></img> 
        
        <script>
            // 1.图片是否进入可视区域
            // 2.将图片的具体地址暂存到 data-src 属性
            // 3.图片进入可视区域后，将 img 标签的 data-src 的属性值赋值给 src 属性

            
            let imgList=[...document.querySelectorAll('img')],len=imgList.length,count=0;
            console.log(imgList,imgList[0].dataset,imgList[0].dataset.src)
            
            const observer=new IntersectionObserver((entries)=>{
                entries.forEach((entry)=>{
                    const{target,intersectionRatio}=entry;
                    if(intersectionRatio>0){
                        target.src=target.dataset.src;
                        console.log('curTarget',target,'intersectionRatio',intersectionRatio);
                        //target是目标dom元素
                        count++;
                        observer.unobserve(target);//使IntersectionObserver对象停止监听特定目标元素
                        
                        if(count==len){//全部加载完毕，可以使IntersectionObserver对象停止监听工作。
                            observer.disconnect();
                        }                    
                    }
                })
            })

            imgList.forEach((itemElement)=> observer.observe(itemElement));
           
        </script>
    </body>
</html>